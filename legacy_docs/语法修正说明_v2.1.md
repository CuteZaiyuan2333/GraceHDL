# GraceHDL 语法修正说明 v2.1

## 📋 修正概述

根据用户反馈，对 GraceHDL v2.0 语法规范进行了精确修正，明确区分了**位宽定义**和**赋值操作**的语法优化范围。

---

## 🎯 修正要点

### 1. **位宽定义** - 保持原有格式
```ghdl
# ✅ 正确格式 - 使用逗号分隔
wire(7, 0) data_bus      # 8位数据总线
reg(31, 0) register      # 32位寄存器
wire(WIDTH-1, 0) signal  # 参数化位宽

# ❌ 错误格式 - 不使用 to
wire(7 to 0) data_bus    # 不采用此格式
```

### 2. **赋值操作** - 使用 to 语句优化
```ghdl
# ✅ 时序逻辑赋值 - 使用 to 替代 <=
run(clk.posedge):
    (counter + 1) to counter    # 替代 counter <= counter + 1
    data_in to data_reg         # 替代 data_reg <= data_in
    
    if reset:
        0 to counter            # 替代 counter <= 0

# ✅ 组合逻辑赋值 - 继续使用等号
always:
    output = input1 and input2  # 组合逻辑保持不变
    result = a + b
```

---

## 📊 语法对比表

| **语法元素** | **v2.0 (错误)** | **v2.1 (修正)** | **说明** |
|-------------|-----------------|-----------------|----------|
| 位宽定义 | `wire(7 to 0)` | `wire(7, 0)` | 保持原有逗号格式 |
| 数组定义 | `reg[15 to 0]` | `reg[15, 0]` | 保持原有逗号格式 |
| 位选择 | `signal[7 to 0]` | `signal[7, 0]` | 保持原有逗号格式 |
| 时序赋值 | `reg <= value` | `value to reg` | 使用 to 语句 |
| 组合赋值 | `wire = value` | `wire = value` | 保持等号不变 |

---

## 🔧 具体修正示例

### 示例1: 计数器模块
```ghdl
module counter:
    parameter(
        WIDTH = 8
    )
    input(
        wire clk,
        wire reset,
        wire(WIDTH-1, 0) load_value    # ✅ 位宽定义用逗号
    )
    output(
        wire(WIDTH-1, 0) count         # ✅ 位宽定义用逗号
    )
    
    register(
        reg(WIDTH-1, 0) counter_reg    # ✅ 位宽定义用逗号
    )
    
    run(clk.posedge):
        if reset:
            0 to counter_reg           # ✅ 时序赋值用 to
        else:
            (counter_reg + 1) to counter_reg  # ✅ 时序赋值用 to
    
    always:
        count = counter_reg            # ✅ 组合赋值用等号
```

### 示例2: 状态机
```ghdl
enum State:
    IDLE = 0
    ACTIVE = 1

module fsm:
    register(
        State current_state,
        reg(7, 0) timer               # ✅ 位宽定义用逗号
    )
    
    run(clk.posedge):
        if reset:
            State.IDLE to current_state    # ✅ 时序赋值用 to
            0 to timer                     # ✅ 时序赋值用 to
        else:
            case current_state:
                State.IDLE:
                    State.ACTIVE to current_state  # ✅ 时序赋值用 to
                State.ACTIVE:
                    (timer + 1) to timer           # ✅ 时序赋值用 to
    
    always:
        ready = (current_state == State.ACTIVE)    # ✅ 组合赋值用等号
```

---

## 🎨 语法设计理念

### 1. **清晰分离**
- **位宽定义**: 属于类型声明，保持传统 Verilog 风格的逗号分隔
- **赋值操作**: 属于行为描述，使用自然语言 `to` 提高可读性

### 2. **一致性原则**
- 所有位宽相关的语法（位宽定义、数组索引、位选择）统一使用逗号
- 所有时序赋值统一使用 `to` 语句
- 所有组合赋值统一使用等号

### 3. **学习友好**
- 位宽定义保持与 Verilog 相似，降低学习门槛
- 赋值操作使用自然语言，避免 `<=` 的混淆

---

## ✅ 修正完成项目

1. ✅ **基本语法结构** - 位宽定义格式修正
2. ✅ **数据类型定义** - 数组和寄存器位宽修正
3. ✅ **操作符部分** - 添加赋值操作符专门说明
4. ✅ **高级语法特性** - 所有示例的位宽定义修正
5. ✅ **扩展功能语法** - 接口、生成块、多时钟域等修正
6. ✅ **示例模块** - 所有示例的位宽和赋值语法修正
7. ✅ **语法风格特点** - 更新描述以反映正确的设计理念

---

## 🚀 语法优势

### 1. **降低学习成本**
- 位宽定义与 Verilog 保持一致
- 只需学习新的赋值语法

### 2. **提高代码可读性**
- `(counter + 1) to counter` 比 `counter <= counter + 1` 更直观
- 避免了 `<=` 与比较运算符的混淆

### 3. **保持工程实用性**
- 位宽定义格式工程师熟悉
- 赋值语法现代化但不激进

---

## 📝 总结

此次修正精确地解决了用户关注的问题：
- **保留**了位宽定义的传统格式 `wire(7, 0)`
- **优化**了赋值操作使用 `to` 语句替代 `<=`
- **维持**了组合逻辑赋值的等号语法

这样的设计既保持了与传统 Verilog 的兼容性，又在关键的赋值操作上提供了更好的可读性，是一个平衡且实用的语法设计方案。